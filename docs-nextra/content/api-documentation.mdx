import { Callout, Tabs, Cards, Card } from 'nextra/components'

# API Documentation

<Callout type="info">
  NeuraScale provides comprehensive REST and WebSocket APIs for real-time neural data streaming and analysis.
</Callout>

## Base URLs

- **Production**: `https://api.neurascale.io/v1`
- **Staging**: `https://api-staging.neurascale.io/v1`
- **Local Development**: `http://localhost:8000/api/v1`

## Authentication

All API requests require authentication using JWT tokens.

```bash
curl -H "Authorization: Bearer YOUR_JWT_TOKEN" \
  https://api.neurascale.io/v1/devices
```

### Obtaining a Token

<Tabs items={['cURL', 'Python', 'JavaScript']}>
  <Tabs.Tab>
    ```bash
    curl -X POST https://api.neurascale.io/v1/auth/login \
      -H "Content-Type: application/json" \
      -d '{
        "email": "user@example.com",
        "password": "your_password"
      }'
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```python
    import requests

    response = requests.post(
        "https://api.neurascale.io/v1/auth/login",
        json={
            "email": "user@example.com",
            "password": "your_password"
        }
    )

    token = response.json()["access_token"]
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```javascript
    const response = await fetch('https://api.neurascale.io/v1/auth/login', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        email: 'user@example.com',
        password: 'your_password'
      })
    });

    const { access_token } = await response.json();
    ```
  </Tabs.Tab>
</Tabs>

## Core Endpoints

<Cards>
  <Card title="Device Management" href="#device-management">
    Connect and manage BCI devices
  </Card>
  <Card title="Data Streaming" href="#data-streaming">
    Real-time neural data streaming
  </Card>
  <Card title="Signal Processing" href="#signal-processing">
    Apply filters and transformations
  </Card>
  <Card title="Machine Learning" href="#machine-learning">
    Run inference and predictions
  </Card>
</Cards>

## Device Management

### List Devices

```http
GET /api/v1/devices
```

**Response:**
```json
{
  "devices": [
    {
      "id": "device_123",
      "name": "OpenBCI Cyton",
      "type": "openbci_cyton",
      "status": "connected",
      "channels": 8,
      "sampling_rate": 250
    }
  ]
}
```

### Connect Device

```http
POST /api/v1/devices/connect
```

**Request Body:**
```json
{
  "device_type": "openbci_cyton",
  "port": "/dev/tty.usbserial-DM01N7BP",
  "options": {
    "sampling_rate": 250,
    "channels": 8
  }
}
```

### Device Status

```http
GET /api/v1/devices/{device_id}/status
```

**Response:**
```json
{
  "device_id": "device_123",
  "connected": true,
  "streaming": false,
  "battery_level": 85,
  "signal_quality": {
    "overall": 0.92,
    "channels": [
      {"id": 1, "impedance": 5200, "quality": 0.95},
      {"id": 2, "impedance": 4800, "quality": 0.96}
    ]
  }
}
```

## Data Streaming

### WebSocket Connection

Connect to WebSocket for real-time data streaming:

```javascript
const ws = new WebSocket('wss://api.neurascale.io/v1/ws');

ws.on('open', () => {
  // Authenticate
  ws.send(JSON.stringify({
    type: 'auth',
    token: 'YOUR_JWT_TOKEN'
  }));

  // Subscribe to device
  ws.send(JSON.stringify({
    type: 'subscribe',
    device_id: 'device_123'
  }));
});

ws.on('message', (data) => {
  const message = JSON.parse(data);
  if (message.type === 'data') {
    console.log('Neural data:', message.samples);
  }
});
```

### Start Streaming

```http
POST /api/v1/devices/{device_id}/stream/start
```

**Request Body:**
```json
{
  "filters": {
    "notch": 60,
    "bandpass": [0.5, 100]
  },
  "output_format": "microvolts"
}
```

### Stop Streaming

```http
POST /api/v1/devices/{device_id}/stream/stop
```

## Signal Processing

### Apply Filters

```http
POST /api/v1/processing/filters
```

**Request Body:**
```json
{
  "device_id": "device_123",
  "filters": [
    {
      "type": "notch",
      "frequency": 60,
      "quality_factor": 30
    },
    {
      "type": "bandpass",
      "low_frequency": 0.5,
      "high_frequency": 100,
      "order": 4
    }
  ]
}
```

### Feature Extraction

```http
POST /api/v1/processing/features
```

**Request Body:**
```json
{
  "device_id": "device_123",
  "window_size": 1000,
  "features": [
    "band_powers",
    "peak_frequency",
    "spectral_entropy"
  ],
  "frequency_bands": {
    "delta": [0.5, 4],
    "theta": [4, 8],
    "alpha": [8, 13],
    "beta": [13, 30],
    "gamma": [30, 100]
  }
}
```

## Machine Learning

### Run Inference

```http
POST /api/v1/ml/inference
```

**Request Body:**
```json
{
  "model_id": "movement_decoder_v2",
  "device_id": "device_123",
  "window_size": 500,
  "overlap": 0.5
}
```

**Response:**
```json
{
  "predictions": [
    {
      "timestamp": 1704067200000,
      "class": "right_hand",
      "confidence": 0.87,
      "probabilities": {
        "rest": 0.08,
        "left_hand": 0.05,
        "right_hand": 0.87
      }
    }
  ]
}
```

### List Available Models

```http
GET /api/v1/ml/models
```

**Response:**
```json
{
  "models": [
    {
      "id": "movement_decoder_v2",
      "name": "Motor Imagery Decoder",
      "type": "classification",
      "input_shape": [8, 500],
      "output_classes": ["rest", "left_hand", "right_hand"],
      "accuracy": 0.89
    }
  ]
}
```

## Data Management

### Create Recording

```http
POST /api/v1/recordings
```

**Request Body:**
```json
{
  "name": "Motor Imagery Session 1",
  "device_id": "device_123",
  "duration": 300,
  "metadata": {
    "subject_id": "subject_001",
    "experiment_type": "motor_imagery",
    "conditions": ["rest", "left_hand", "right_hand"]
  }
}
```

### Export Data

```http
POST /api/v1/recordings/{recording_id}/export
```

**Request Body:**
```json
{
  "format": "edf",
  "include_annotations": true,
  "time_range": {
    "start": "2024-01-01T10:00:00Z",
    "end": "2024-01-01T10:05:00Z"
  }
}
```

## Error Handling

All errors follow a consistent format:

```json
{
  "error": {
    "code": "DEVICE_NOT_FOUND",
    "message": "Device with ID 'device_123' not found",
    "details": {
      "device_id": "device_123",
      "available_devices": ["device_456", "device_789"]
    }
  }
}
```

### Common Error Codes

| Code | Description | HTTP Status |
|------|-------------|-------------|
| `UNAUTHORIZED` | Invalid or missing token | 401 |
| `FORBIDDEN` | Insufficient permissions | 403 |
| `DEVICE_NOT_FOUND` | Device ID not found | 404 |
| `DEVICE_BUSY` | Device already in use | 409 |
| `INVALID_PARAMETERS` | Invalid request parameters | 400 |
| `RATE_LIMITED` | Too many requests | 429 |

## Rate Limits

<Callout type="warning">
  API rate limits apply to prevent abuse and ensure fair usage.
</Callout>

- **Authentication**: 10 requests per minute
- **Device Operations**: 100 requests per minute
- **Data Streaming**: No limit (WebSocket)
- **ML Inference**: 50 requests per minute

## SDKs and Libraries

Official SDKs are available:

- [Python SDK](https://github.com/neurascale/python-sdk)
- [JavaScript/TypeScript SDK](https://github.com/neurascale/js-sdk)
- [MATLAB Toolbox](https://github.com/neurascale/matlab-toolbox)

## Interactive API Explorer

Try our API endpoints directly in your browser:

<Cards>
  <Card title="API Playground" href="https://api.neurascale.io/docs">
    Interactive OpenAPI documentation
  </Card>
  <Card title="GraphQL Explorer" href="https://api.neurascale.io/graphql">
    GraphQL API with GraphiQL interface
  </Card>
</Cards>

## Support

For API support:
- ðŸ“§ Email: api-support@neurascale.io
- ðŸ’¬ Discord: [NeuraScale Developers](https://discord.gg/neurascale)
- ðŸ“š GitHub: [Open an issue](https://github.com/neurascale/neurascale/issues)
